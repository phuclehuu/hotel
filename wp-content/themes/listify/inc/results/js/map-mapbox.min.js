!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b():"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?exports.GeoSearch=b():a.GeoSearch=b()}(this,function(){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){c(2),a.exports=c(7)},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var e=c(2),f=(function(a){return a&&a.__esModule?a:{default:a}}(e),function(){function a(a,b){for(var c=0;b.length>c;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}()),g=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};d(this,a),this.options=b}return f(a,[{key:"getParamString",value:function(a){return Object.keys(a).map(function(b){return encodeURIComponent(b)+"="+encodeURIComponent(a[b])}).join("&")}},{key:"search",value:function(a){return new Promise(function(b,c){var d,e,f,g,h;return d=a.query,e=~location.protocol.indexOf("http")?location.protocol:"https:",f=this.endpoint({query:d,protocol:e}),fetch(f).then(function(a){return g=a,g.json().then(function(a){return h=a,b(this.parse({data:h}))}.$asyncbind(this,c),c)}.$asyncbind(this,c),c)}.$asyncbind(this))}}]),a}();b.default=g},function(a,b,c){"use strict";function d(a,b){if(Function.prototype.$asyncspawn||Object.defineProperty(Function.prototype,"$asyncspawn",{value:d,enumerable:!1,configurable:!0,writable:!0}),this instanceof Function){var c=this;return new a(function(a,d){function e(b,c){var g;try{if(g=b.call(f,c),g.done){if(g.value!==a){if(g.value&&g.value===g.value.then)return g.value(a,d);a&&a(g.value),a=null}return}g.value.then?g.value.then(function(a){e(f.next,a)},function(a){e(f.throw,a)}):e(f.next,g.value)}catch(a){return d&&d(a),void(d=null)}}var f=c.call(b,a,d);e(f.next)})}}var e=function(a,b){for(var c=""+b,d="return "+c,e=c.match(/.*\(([^)]*)\)/)[1],f=/['"]!!!([^'"]*)['"]/g,g=[];;){var h=f.exec(d);if(!h)break;g.push(h)}return g.reverse().forEach(function(b){d=d.slice(0,b.index)+a[b[1]]+d.substr(b.index+b[0].length)}),d=d.replace(/\/\*[^*]*\*\//g," ").replace(/\s+/g," "),Function(e,d)()}({zousan:""+c(16),thenable:""+c(15)},function a(b,c){function d(){return e.apply(b,arguments)}Function.prototype.$asyncbind||Object.defineProperty(Function.prototype,"$asyncbind",{value:a,enumerable:!1,configurable:!0,writable:!0}),a.trampoline||(a.trampoline=function(a,b,c,d,e){return function f(g){for(;g;){if(g.then)return g=g.then(f,d),e?void 0:g;try{if(g.pop){if(g.length)return g.pop()?b.call(a):g;g=c}else g=g.call(a)}catch(a){return d(a)}}}}),a.LazyThenable||(a.LazyThenable="!!!thenable"(),a.EagerThenable=a.Thenable=(a.EagerThenableFactory="!!!zousan")());var e=this;switch(c){case!0:return new a.Thenable(d);case 0:return new a.LazyThenable(d);case void 0:return d.then=d,d;default:return function(){try{return e.apply(b,arguments)}catch(a){return c(a)}}}});e(),d(),a.exports={$asyncbind:e,$asyncspawn:d}},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=b.createElement=function(a){var b=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,d=document.createElement(a);return d.className=b,c&&c.appendChild(d),d};b.createScriptElement=function(a,b){var d=c("script",null,document.body);return d.setAttribute("type","text/javascript"),new Promise(function(c){window[b]=function(a){d.remove(),delete window[b],c(a)},d.setAttribute("src",a)})},b.addClassName=function(a,b){a&&!a.classList.contains(b)&&a.classList.add(b)},b.removeClassName=function(a,b){a&&a.classList.contains(b)&&a.classList.remove(b)}},function(a,b){"use strict";Object.defineProperty(b,"__esModule",{value:!0});var c=b.ENTER_KEY=13,d=b.ESCAPE_KEY=27,e=b.ARROW_DOWN_KEY=40,f=b.ARROW_UP_KEY=38,g=b.ARROW_LEFT_KEY=37,h=b.ARROW_RIGHT_KEY=39;b.SPECIAL_KEYS=[c,d,e,f,g,h]},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var e=c(2),f=(function(a){return a&&a.__esModule?a:{default:a}}(e),function(){function a(a,b){for(var c=0;b.length>c;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}()),g=c(3),h=c(4),i=function(){function a(){var b=this,c=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=c.handleSubmit,f=void 0===e?function(){}:e,h=c.searchLabel,i=void 0===h?"search":h,j=c.classNames,k=void 0===j?{}:j;d(this,a);var l=(0,g.createElement)("div",["geosearch",k.container].join(" ")),m=(0,g.createElement)("form",["",k.form].join(" "),l),n=(0,g.createElement)("input",["glass",k.input].join(" "),m);n.type="text",n.placeholder=i,n.addEventListener("input",function(a){b.onInput(a)},!1),n.addEventListener("keyup",function(a){b.onKeyUp(a)},!1),n.addEventListener("keypress",function(a){b.onKeyPress(a)},!1),n.addEventListener("focus",function(a){b.onFocus(a)},!1),n.addEventListener("blur",function(a){b.onBlur(a)},!1),this.elements={container:l,form:m,input:n},this.handleSubmit=f}return f(a,[{key:"onFocus",value:function(){(0,g.addClassName)(this.elements.form,"active")}},{key:"onBlur",value:function(){(0,g.removeClassName)(this.elements.form,"active")}},{key:"onSubmit",value:function(a){return new Promise(function(b,c){var d,e,f;return a.preventDefault(),a.stopPropagation(),d=this.elements,e=d.input,f=d.container,(0,g.removeClassName)(f,"error"),(0,g.addClassName)(f,"pending"),this.handleSubmit({query:e.value}).then(function(a){return(0,g.removeClassName)(f,"pending"),b()}.$asyncbind(this,c),c)}.$asyncbind(this))}},{key:"onInput",value:function(){var a=this.elements.container;this.hasError&&((0,g.removeClassName)(a,"error"),this.hasError=!1)}},{key:"onKeyUp",value:function(a){var b=this.elements,c=b.container,d=b.input;a.keyCode===h.ESCAPE_KEY&&((0,g.removeClassName)(c,"pending"),(0,g.removeClassName)(c,"active"),d.value="",document.body.focus(),document.body.blur())}},{key:"onKeyPress",value:function(a){a.keyCode===h.ENTER_KEY&&this.onSubmit(a)}},{key:"setQuery",value:function(a){this.elements.input.value=a}}]),a}();b.default=i},function(a,b){function c(){throw Error("setTimeout has not been defined")}function d(){throw Error("clearTimeout has not been defined")}function e(a){if(k===setTimeout)return setTimeout(a,0);if((k===c||!k)&&setTimeout)return k=setTimeout,setTimeout(a,0);try{return k(a,0)}catch(b){try{return k.call(null,a,0)}catch(b){return k.call(this,a,0)}}}function f(a){if(l===clearTimeout)return clearTimeout(a);if((l===d||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(a);try{return l(a)}catch(b){try{return l.call(null,a)}catch(b){return l.call(this,a)}}}function g(){p&&n&&(p=!1,n.length?o=n.concat(o):q=-1,o.length&&h())}function h(){if(!p){var a=e(g);p=!0;for(var b=o.length;b;){for(n=o,o=[];++q<b;)n&&n[q].run();q=-1,b=o.length}n=null,p=!1,f(a)}}function i(a,b){this.fun=a,this.array=b}function j(){}var k,l,m=a.exports={};!function(){try{k="function"==typeof setTimeout?setTimeout:c}catch(a){k=c}try{l="function"==typeof clearTimeout?clearTimeout:d}catch(a){l=d}}();var n,o=[],p=!1,q=-1;m.nextTick=function(a){var b=Array(arguments.length-1);if(arguments.length>1)for(var c=1;arguments.length>c;c++)b[c-1]=arguments[c];o.push(new i(a,b)),1!==o.length||p||e(h)},i.prototype.run=function(){this.fun.apply(null,this.array)},m.title="browser",m.browser=!0,m.env={},m.argv=[],m.version="",m.versions={},m.on=j,m.addListener=j,m.once=j,m.off=j,m.removeListener=j,m.removeAllListeners=j,m.emit=j,m.binding=function(a){throw Error("process.binding is not supported")},m.cwd=function(){return"/"},m.chdir=function(a){throw Error("process.chdir is not supported")},m.umask=function(){return 0}},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(b,"__esModule",{value:!0});var e=c(8);Object.defineProperty(b,"GeoSearchControl",{enumerable:!0,get:function(){return d(e).default}});var f=c(5);Object.defineProperty(b,"SearchElement",{enumerable:!0,get:function(){return d(f).default}});var g=c(9);Object.defineProperty(b,"BingProvider",{enumerable:!0,get:function(){return d(g).default}});var h=c(10);Object.defineProperty(b,"EsriProvider",{enumerable:!0,get:function(){return d(h).default}});var i=c(11);Object.defineProperty(b,"GoogleProvider",{enumerable:!0,get:function(){return d(i).default}});var j=c(12);Object.defineProperty(b,"OpenStreetMapProvider",{enumerable:!0,get:function(){return d(j).default}});var k=c(1);Object.defineProperty(b,"Provider",{enumerable:!0,get:function(){return d(k).default}})},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(){if(!L||!L.Control||!L.Control.extend)throw Error("Leaflet must be loaded before instantiating the GeoSearch control");for(var a=L.Control.extend(q),b=arguments.length,c=Array(b),d=0;b>d;d++)c[d]=arguments[d];return new(Function.prototype.bind.apply(a,[null].concat(c)))}Object.defineProperty(b,"__esModule",{value:!0});var f=c(2),g=(d(f),Object.assign||function(a){for(var b=1;arguments.length>b;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a});b.default=e;var h=c(14),i=d(h),j=c(5),k=d(j),l=c(13),m=d(l),n=c(3),o=c(4),p=function(){return{position:"topleft",style:"button",showMarker:!0,showPopup:!1,marker:{icon:new L.Icon.Default,draggable:!1},maxMarkers:1,retainZoomLevel:!1,animateZoom:!0,searchLabel:"Enter address",notFoundMessage:"Sorry, that address could not be found.",messageHideDelay:3e3,zoomLevel:18,classNames:{container:"leaflet-bar leaflet-control leaflet-control-geosearch",button:"leaflet-bar-part leaflet-bar-part-single",msgbox:"leaflet-bar message",form:"",input:""},autoComplete:!0,autoCompleteDelay:250}},q={initialize:function(a){var b=this;this.markers=new L.FeatureGroup,this.options=g({},p(),a);var c=this.options,d=c.style,e=c.classNames,f=c.searchLabel,h=c.autoComplete,j=c.autoCompleteDelay;"button"!==d&&(this.options.classNames.container+=" "+a.style),this.searchElement=new k.default(g({},this.options,{handleSubmit:function(a){return b.onSubmit(a)}}));var l=this.searchElement.elements,o=l.container,q=l.form,r=l.input;o.addEventListener("dblclick",function(a){a.stopPropagation()});var s=(0,n.createElement)("a",e.button,o);s.title=f,s.href="#",s.addEventListener("click",function(a){b.onClick(a)},!1),h&&(this.resultList=new m.default({handleClick:function(a){var c=a.result;r.value=c.label,b.onSubmit({query:c.label})}}),q.appendChild(this.resultList.elements.container),r.addEventListener("keyup",(0,i.default)(function(a){return b.autoSearch(a)},j),!0),r.addEventListener("keydown",function(a){return b.selectResult(a)},!0),r.addEventListener("keydown",function(a){return b.clearResults(a)},!0)),this.elements={button:s}},onAdd:function(a){var b=this.options,c=b.showMarker,d=b.style;if(this.map=a,c&&this.markers.addTo(a),"bar"===d){var e=this.searchElement.elements.form,f=a.getContainer().querySelector(".leaflet-control-container"),g=(0,n.createElement)("div","leaflet-control-geosearch bar");g.appendChild(e),f.appendChild(g),this.elements.container=g}return this.searchElement.elements.container},onRemove:function(){var a=this.elements.container;return a&&a.remove(),this},onClick:function(a){a.preventDefault();var b=this.searchElement.elements,c=b.container,d=b.input;c.classList.contains("active")?(0,n.removeClassName)(c,"active"):((0,n.addClassName)(c,"active"),d.focus())},selectResult:function(a){if([o.ARROW_DOWN_KEY,o.ARROW_UP_KEY].includes(a.keyCode)){a.preventDefault();var b=this.searchElement.elements.input,c=this.resultList,d=this.resultList.count()-1,e="ArrowDown"===a.code?1+~~c.selected:~~c.selected-1,f=0>e?d:e>d?0:e,g=c.select(f);b.value=g.label}},clearResults:function(a){a.keyCode===o.ESCAPE_KEY&&this.resultList.clear()},autoSearch:function(a){return new Promise(function(b,c){var d,e,f;return o.SPECIAL_KEYS.includes(a.keyCode)?b():(d=a.target.value,e=this.options.provider,e.search({query:d}).then(function(a){return f=a,this.resultList.render(f),b()}.$asyncbind(this,c),c))}.$asyncbind(this))},onSubmit:function(a){return new Promise(function(b,c){var d,e;return d=this.options.provider,d.search(a).then(function(a){return e=a,e&&e.length>0&&this.showResult(e[0]),b()}.$asyncbind(this,c),c)}.$asyncbind(this))},showResult:function(a){var b=Object.keys(this.markers._layers);this.options.maxMarkers>b.length||this.markers.removeLayer(b[0]);var c=this.addMarker(a);this.centerMap(a),this.map.fireEvent("geosearch/showlocation",{location:a,marker:c})},addMarker:function(a){var b=this.options,c=b.marker,d=b.showPopup,e=new L.Marker([a.y,a.x],c);return e.bindPopup(a.label),this.markers.addLayer(e),d&&e.openPopup(),e},centerMap:function(a){var b=this.options,c=b.retainZoomLevel,d=b.animateZoom,e=new L.LatLngBounds(a.bounds),f=e.isValid()?e:this.markers.getBounds();!c&&e.isValid()?this.map.fitBounds(f,{animate:d}):this.map.setView(f.getCenter(),this.getZoom(),{animate:d})},getZoom:function(){var a=this.options,b=a.retainZoomLevel,c=a.zoomLevel;return b?this.map.getZoom():c}}},function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function f(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function g(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var h=c(2),i=(d(h),Object.assign||function(a){for(var b=1;arguments.length>b;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a}),j=function(){function a(a,b){for(var c=0;b.length>c;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),k=c(1),l=d(k),m=c(3),n=function(a){function b(){return e(this,b),f(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return g(b,a),j(b,[{key:"endpoint",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=a.query,c=a.protocol,d=a.jsonp,e=this.options.params;return c+"//dev.virtualearth.net/REST/v1/Locations?"+this.getParamString(i({},e,{query:b,jsonp:d}))}},{key:"parse",value:function(a){var b=a.data;return 0===b.resourceSets.length?[]:b.resourceSets[0].resources.map(function(a){return{x:a.point.coordinates[1],y:a.point.coordinates[0],label:a.address.formattedAddress,bounds:[[a.bbox[0],a.bbox[1]],[a.bbox[2],a.bbox[3]]],raw:a}})}},{key:"search",value:function(a){return new Promise(function(b,c){var d,e,f,g,h;return d=a.query,e=~location.protocol.indexOf("http")?location.protocol:"https:",f="BING_JSONP_CB_"+Date.now(),g=this.endpoint({query:d,protocol:e,jsonp:f}),(0,m.createScriptElement)(g,f).then(function(a){return h=a,b(this.parse({data:h}))}.$asyncbind(this,c),c)}.$asyncbind(this))}}]),b}(l.default);b.default=n},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var g=Object.assign||function(a){for(var b=1;arguments.length>b;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},h=function(){function a(a,b){for(var c=0;b.length>c;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=c(1),j=function(a){return a&&a.__esModule?a:{default:a}}(i),k=function(a){function b(){return d(this,b),e(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return f(b,a),h(b,[{key:"endpoint",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=a.query,c=a.protocol,d=this.options.params;return c+"//geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer/find?"+this.getParamString(g({},d,{f:"json",text:b}))}},{key:"parse",value:function(a){return a.data.locations.map(function(a){return{x:a.feature.geometry.x,y:a.feature.geometry.y,label:a.name,bounds:[[a.extent.ymin,a.extent.xmin],[a.extent.ymax,a.extent.xmax]],raw:a}})}}]),b}(j.default);b.default=k},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var g=Object.assign||function(a){for(var b=1;arguments.length>b;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},h=function(){function a(a,b){for(var c=0;b.length>c;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=c(1),j=function(a){return a&&a.__esModule?a:{default:a}}(i),k=function(a){function b(){return d(this,b),e(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return f(b,a),h(b,[{key:"endpoint",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=a.query,c=a.protocol,d=this.options.params,e=this.getParamString(g({},d,{address:b}));return(d&&d.key?"https:":c)+"//maps.googleapis.com/maps/api/geocode/json?"+e}},{key:"parse",value:function(a){return a.data.results.map(function(a){return{x:a.geometry.location.lng,y:a.geometry.location.lat,label:a.formatted_address,bounds:[[a.geometry.viewport.southwest.lat,a.geometry.viewport.southwest.lng],[a.geometry.viewport.northeast.lat,a.geometry.viewport.northeast.lng]],raw:a}})}}]),b}(j.default);b.default=k},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function e(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!=typeof b&&"function"!=typeof b?a:b}function f(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(b,"__esModule",{value:!0});var g=Object.assign||function(a){for(var b=1;arguments.length>b;b++){var c=arguments[b];for(var d in c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d])}return a},h=function(){function a(a,b){for(var c=0;b.length>c;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),i=c(1),j=function(a){return a&&a.__esModule?a:{default:a}}(i),k=function(a){function b(){return d(this,b),e(this,(b.__proto__||Object.getPrototypeOf(b)).apply(this,arguments))}return f(b,a),h(b,[{key:"endpoint",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},b=a.query,c=a.protocol,d=this.options.params;return c+"//nominatim.openstreetmap.org/search?"+this.getParamString(g({},d,{format:"json",q:b}))}},{key:"parse",value:function(a){return a.data.map(function(a){return{x:a.lon,y:a.lat,label:a.display_name,bounds:[[parseFloat(a.boundingbox[0]),parseFloat(a.boundingbox[2])],[parseFloat(a.boundingbox[1]),parseFloat(a.boundingbox[3])]],raw:a}})}}]),b}(j.default);b.default=k},function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(b,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;b.length>c;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=c(3),g=function(){for(var a=arguments.length,b=Array(a),c=0;a>c;c++)b[c]=arguments[c];return b.join(" ").trim()},h=function(){function a(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=b.handleClick,e=void 0===c?function(){}:c,h=b.classNames,j=void 0===h?{}:h;d(this,a),i.call(this),this.props={handleClick:e,classNames:j},this.selected=-1;var k=(0,f.createElement)("div",g("results",j.container)),l=(0,f.createElement)("div",g(j.item));k.addEventListener("click",this.onClick,!0),this.elements={container:k,resultItem:l}}return e(a,[{key:"render",value:function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],b=this.elements,c=b.container,d=b.resultItem;this.clear(),a.forEach(function(a,b){var e=d.cloneNode(!0);e.setAttribute("data-key",b),e.innerHTML=a.label,c.appendChild(e)}),a.length>0&&(0,f.addClassName)(c,"active"),this.results=a}},{key:"select",value:function(a){var b=this.elements.container;return Array.from(b.children).forEach(function(b,c){return c===a?(0,f.addClassName)(b,"active"):(0,f.removeClassName)(b,"active")}),this.selected=a,this.results[a]}},{key:"count",value:function(){return this.results.length}},{key:"clear",value:function(){var a=this.elements.container;for(this.selected=-1;a.lastChild;)a.removeChild(a.lastChild);(0,f.removeClassName)(a,"active")}}]),a}(),i=function(){var a=this;this.onClick=function(){var b=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},c=b.target,d=a.props.handleClick,e=a.elements.container;if(c.parentNode===e&&c.hasAttribute("data-key")){var f=c.getAttribute("data-key");d({result:a.results[f]})}}};b.default=h},function(a,b){(function(b){function c(a,b,c){function e(b){var c=p,d=q;return p=q=void 0,y=b,s=a.apply(d,c)}function f(a){return y=a,t=setTimeout(k,b),z?e(a):s}function i(a){var c=a-x,d=a-y,e=b-c;return A?v(e,r-d):e}function j(a){var c=a-x,d=a-y;return void 0===x||c>=b||0>c||A&&d>=r}function k(){var a=w();return j(a)?l(a):void(t=setTimeout(k,i(a)))}function l(a){return t=void 0,B&&p?e(a):(p=q=void 0,s)}function m(){void 0!==t&&clearTimeout(t),y=0,p=x=q=t=void 0}function n(){return void 0===t?s:l(w())}function o(){var a=w(),c=j(a);if(p=arguments,q=this,x=a,c){if(void 0===t)return f(x);if(A)return t=setTimeout(k,b),e(x)}return void 0===t&&(t=setTimeout(k,b)),s}var p,q,r,s,t,x,y=0,z=!1,A=!1,B=!0;if("function"!=typeof a)throw new TypeError(h);return b=g(b)||0,d(c)&&(z=!!c.leading,A="maxWait"in c,r=A?u(g(c.maxWait)||0,b):r,B="trailing"in c?!!c.trailing:B),o.cancel=m,o.flush=n,o}function d(a){var b=typeof a;return!!a&&("object"==b||"function"==b)}function e(a){return!!a&&"object"==typeof a}function f(a){return"symbol"==typeof a||e(a)&&t.call(a)==j}function g(a){if("number"==typeof a)return a;if(f(a))return i;if(d(a)){var b="function"==typeof a.valueOf?a.valueOf():a;a=d(b)?b+"":b}if("string"!=typeof a)return 0===a?a:+a;a=a.replace(k,"");var c=m.test(a);return c||n.test(a)?o(a.slice(2),c?2:8):l.test(a)?i:+a}var h="Expected a function",i=NaN,j="[object Symbol]",k=/^\s+|\s+$/g,l=/^[-+]0x[0-9a-f]+$/i,m=/^0b[01]+$/i,n=/^0o[0-7]+$/i,o=parseInt,p="object"==typeof b&&b&&b.Object===Object&&b,q="object"==typeof self&&self&&self.Object===Object&&self,r=p||q||Function("return this")(),s=Object.prototype,t=s.toString,u=Math.max,v=Math.min,w=function(){return r.Date.now()};a.exports=c}).call(b,function(){return this}())},function(a,b){a.exports=function(){function a(a){return a&&a instanceof Object&&"function"==typeof a.then}function b(c,d,e){try{var f=e?e(d):d;if(c===f)return c.reject(new TypeError("Promise resolution loop"));a(f)?f.then(function(a){b(c,a)},function(a){c.reject(a)}):c.resolve(f)}catch(a){c.reject(a)}}function c(){}function d(a){}function e(a,b){this.resolve=a,this.reject=b}function f(d,e){var f=new c;try{this._resolver(function(c){return a(c)?c.then(d,e):b(f,c,d)},function(a){b(f,a,e)})}catch(a){b(f,a,e)}return f}function g(a){this._resolver=a,this.then=f}return c.prototype={resolve:d,reject:d,then:e},g.resolve=function(a){return g.isThenable(a)?a:{then:function(b){return b(a)}}},g.isThenable=a,g}},function(a,b,c){(function(b,c){"use strict";a.exports=function(a){function d(a){if(a){var b=this;a(function(a){b.resolve(a)},function(a){b.reject(a)})}}function e(a,b){if("function"==typeof a.y)try{var c=a.y.call(void 0,b);a.p.resolve(c)}catch(b){a.p.reject(b)}else a.p.resolve(b)}function f(a,b){if("function"==typeof a.n)try{var c=a.n.call(void 0,b);a.p.resolve(c)}catch(b){a.p.reject(b)}else a.p.reject(b)}a=a||"object"==typeof b&&b.nextTick||"function"==typeof c&&c||function(a){setTimeout(a,0)};var g=function(){function b(){for(;c.length-d;)c[d](),c[d++]=void 0,d===e&&(c.splice(0,e),d=0)}var c=[],d=0,e=1024;return function(e){c.push(e),c.length-d==1&&a(b)}}();return d.prototype={resolve:function(a){if(void 0===this.state){if(a===this)return this.reject(new TypeError("Attempt to resolve promise with self"));var b=this;if(a&&("function"==typeof a||"object"==typeof a))try{var c=0,d=a.then;if("function"==typeof d)return void d.call(a,function(a){c++||b.resolve(a)},function(a){c++||b.reject(a)})}catch(a){return void(c||this.reject(a))}this.state=e,this.v=a,b.c&&g(function(){for(var c=0,d=b.c.length;d>c;c++)e(b.c[c],a)})}},reject:function(a){if(void 0===this.state){this.state=f,this.v=a;var b=this.c;b&&g(function(){for(var c=0,d=b.length;d>c;c++)f(b[c],a)})}},then:function(a,b){var c=new d,e={y:a,n:b,p:c};if(void 0===this.state)this.c?this.c.push(e):this.c=[e];else{var f=this.state,h=this.v;g(function(){f(e,h)})}return c}},d.resolve=function(a){if(a&&a instanceof d)return a;var b=new d;return b.resolve(a),b},d.reject=function(a){if(a&&a instanceof d)return a;var b=new d;return b.reject(a),b},d.version="2.3.2-nodent",d}}).call(b,c(6),c(18).setImmediate)},function(a,b,c){(function(a,b){!function(a,c){"use strict";function d(a){"function"!=typeof a&&(a=Function(""+a));for(var b=Array(arguments.length-1),c=0;b.length>c;c++)b[c]=arguments[c+1];var d={callback:a,args:b};return j[i]=d,h(i),i++}function e(a){delete j[a]}function f(a){var b=a.callback,d=a.args;switch(d.length){case 0:b();break;case 1:b(d[0]);break;case 2:b(d[0],d[1]);break;case 3:b(d[0],d[1],d[2]);break;default:b.apply(c,d)}}function g(a){if(k)setTimeout(g,0,a);else{var b=j[a];if(b){k=!0;try{f(b)}finally{e(a),k=!1}}}}if(!a.setImmediate){var h,i=1,j={},k=!1,l=a.document,m=Object.getPrototypeOf&&Object.getPrototypeOf(a);m=m&&m.setTimeout?m:a,"[object process]"==={}.toString.call(a.process)?function(){h=function(a){b.nextTick(function(){g(a)})}}():function(){if(a.postMessage&&!a.importScripts){var b=!0,c=a.onmessage;return a.onmessage=function(){b=!1},a.postMessage("","*"),a.onmessage=c,b}}()?function(){var b="setImmediate$"+Math.random()+"$",c=function(c){c.source===a&&"string"==typeof c.data&&0===c.data.indexOf(b)&&g(+c.data.slice(b.length))};a.addEventListener?a.addEventListener("message",c,!1):a.attachEvent("onmessage",c),h=function(c){a.postMessage(b+c,"*")}}():a.MessageChannel?function(){var a=new MessageChannel;a.port1.onmessage=function(a){g(a.data)},h=function(b){a.port2.postMessage(b)}}():l&&"onreadystatechange"in l.createElement("script")?function(){var a=l.documentElement;h=function(b){var c=l.createElement("script");c.onreadystatechange=function(){g(b),c.onreadystatechange=null,a.removeChild(c),c=null},a.appendChild(c)}}():function(){h=function(a){setTimeout(g,0,a)}}(),m.setImmediate=d,m.clearImmediate=e}}("undefined"==typeof self?void 0===a?this:a:self)}).call(b,function(){return this}(),c(6))},function(a,b,c){function d(a,b){this._id=a,this._clearFn=b}var e=Function.prototype.apply;b.setTimeout=function(){return new d(e.call(setTimeout,window,arguments),clearTimeout)},b.setInterval=function(){return new d(e.call(setInterval,window,arguments),clearInterval)},b.clearTimeout=b.clearInterval=function(a){a&&a.close()},d.prototype.unref=d.prototype.ref=function(){},d.prototype.close=function(){this._clearFn.call(window,this._id)},b.enroll=function(a,b){clearTimeout(a._idleTimeoutId),a._idleTimeout=b},b.unenroll=function(a){clearTimeout(a._idleTimeoutId),a._idleTimeout=-1},b._unrefActive=b.active=function(a){clearTimeout(a._idleTimeoutId);var b=a._idleTimeout;0>b||(a._idleTimeoutId=setTimeout(function(){a._onTimeout&&a._onTimeout()},b))},c(17),b.setImmediate=setImmediate,b.clearImmediate=clearImmediate}])}),function(a,b,c){L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(a){L.Util.setOptions(this,a),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this._featureGroup=L.featureGroup(),this._featureGroup.addEventParent(this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.addEventParent(this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[],this._childMarkerEventHandlers={dragstart:this._childMarkerDragStart,move:this._childMarkerMoved,dragend:this._childMarkerDragEnd};var b=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,b?this._withAnimation:this._noAnimation),this._markerCluster=b?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(a){if(a instanceof L.LayerGroup)return this.addLayers([a]);if(!a.getLatLng)return this._nonPointGroup.addLayer(a),this.fire("layeradd",{layer:a}),this;if(!this._map)return this._needsClustering.push(a),this.fire("layeradd",{layer:a}),this;if(this.hasLayer(a))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(a,this._maxZoom),this.fire("layeradd",{layer:a}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons();var b=a,c=this._zoom;if(a.__parent)for(;b.__parent._zoom>=c;)b=b.__parent;return this._currentShownBounds.contains(b.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(a,b):this._animationAddLayerNonAnimated(a,b)),this},removeLayer:function(a){return a instanceof L.LayerGroup?this.removeLayers([a]):a.getLatLng?this._map?a.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(a)),this._removeLayer(a,!0),
this.fire("layerremove",{layer:a}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),a.off(this._childMarkerEventHandlers,this),this._featureGroup.hasLayer(a)&&(this._featureGroup.removeLayer(a),a.clusterShow&&a.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,a)&&this.hasLayer(a)&&this._needsRemoving.push({layer:a,latlng:a._latlng}),this.fire("layerremove",{layer:a}),this):(this._nonPointGroup.removeLayer(a),this.fire("layerremove",{layer:a}),this)},addLayers:function(a,b){if(!L.Util.isArray(a))return this.addLayer(a);var c,d=this._featureGroup,e=this._nonPointGroup,f=this.options.chunkedLoading,g=this.options.chunkInterval,h=this.options.chunkProgress,i=a.length,j=0,k=!0;if(this._map){var l=(new Date).getTime(),m=L.bind(function(){for(var n=(new Date).getTime();i>j;j++){if(f&&0==j%200){if((new Date).getTime()-n>g)break}if((c=a[j])instanceof L.LayerGroup)k&&(a=a.slice(),k=!1),this._extractNonGroupLayers(c,a),i=a.length;else if(c.getLatLng){if(!this.hasLayer(c)&&(this._addLayer(c,this._maxZoom),b||this.fire("layeradd",{layer:c}),c.__parent&&2===c.__parent.getChildCount())){var o=c.__parent.getAllChildMarkers(),p=o[0]===c?o[1]:o[0];d.removeLayer(p)}}else e.addLayer(c),b||this.fire("layeradd",{layer:c})}h&&h(j,i,(new Date).getTime()-l),j===i?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(m,this.options.chunkDelay)},this);m()}else for(var n=this._needsClustering;i>j;j++)c=a[j],c instanceof L.LayerGroup?(k&&(a=a.slice(),k=!1),this._extractNonGroupLayers(c,a),i=a.length):c.getLatLng?this.hasLayer(c)||n.push(c):e.addLayer(c);return this},removeLayers:function(a){var b,c,d=a.length,e=this._featureGroup,f=this._nonPointGroup,g=!0;if(!this._map){for(b=0;d>b;b++)c=a[b],c instanceof L.LayerGroup?(g&&(a=a.slice(),g=!1),this._extractNonGroupLayers(c,a),d=a.length):(this._arraySplice(this._needsClustering,c),f.removeLayer(c),this.hasLayer(c)&&this._needsRemoving.push({layer:c,latlng:c._latlng}),this.fire("layerremove",{layer:c}));return this}if(this._unspiderfy){this._unspiderfy();var h=a.slice(),i=d;for(b=0;i>b;b++)c=h[b],c instanceof L.LayerGroup?(this._extractNonGroupLayers(c,h),i=h.length):this._unspiderfyLayer(c)}for(b=0;d>b;b++)c=a[b],c instanceof L.LayerGroup?(g&&(a=a.slice(),g=!1),this._extractNonGroupLayers(c,a),d=a.length):c.__parent?(this._removeLayer(c,!0,!0),this.fire("layerremove",{layer:c}),e.hasLayer(c)&&(e.removeLayer(c),c.clusterShow&&c.clusterShow())):(f.removeLayer(c),this.fire("layerremove",{layer:c}));return this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),this},clearLayers:function(){return this._map||(this._needsClustering=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(a){a.off(this._childMarkerEventHandlers,this),delete a.__parent},this),this._map&&this._generateInitialClusters(),this},getBounds:function(){var a=new L.LatLngBounds;this._topClusterLevel&&a.extend(this._topClusterLevel._bounds);for(var b=this._needsClustering.length-1;b>=0;b--)a.extend(this._needsClustering[b].getLatLng());return a.extend(this._nonPointGroup.getBounds()),a},eachLayer:function(a,b){var c,d,e,f=this._needsClustering.slice(),g=this._needsRemoving;for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(f),d=f.length-1;d>=0;d--){for(c=!0,e=g.length-1;e>=0;e--)if(g[e].layer===f[d]){c=!1;break}c&&a.call(b,f[d])}this._nonPointGroup.eachLayer(a,b)},getLayers:function(){var a=[];return this.eachLayer(function(b){a.push(b)}),a},getLayer:function(a){var b=null;return a=parseInt(a,10),this.eachLayer(function(c){L.stamp(c)===a&&(b=c)}),b},hasLayer:function(a){if(!a)return!1;var b,c=this._needsClustering;for(b=c.length-1;b>=0;b--)if(c[b]===a)return!0;for(c=this._needsRemoving,b=c.length-1;b>=0;b--)if(c[b].layer===a)return!1;return!(!a.__parent||a.__parent._group!==this)||this._nonPointGroup.hasLayer(a)},zoomToShowLayer:function(a,b){"function"!=typeof b&&(b=function(){});var c=function(){!a._icon&&!a.__parent._icon||this._inZoomAnimation||(this._map.off("moveend",c,this),this.off("animationend",c,this),a._icon?b():a.__parent._icon&&(this.once("spiderfied",b,this),a.__parent.spiderfy()))};a._icon&&this._map.getBounds().contains(a.getLatLng())?b():a.__parent._zoom<Math.round(this._map._zoom)?(this._map.on("moveend",c,this),this._map.panTo(a.getLatLng())):(this._map.on("moveend",c,this),this.on("animationend",c,this),a.__parent.zoomToBounds())},onAdd:function(a){this._map=a;var b,c,d;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.addTo(a),this._nonPointGroup.addTo(a),this._gridClusters||this._generateInitialClusters(),this._maxLat=a.options.crs.projection.MAX_LATITUDE,b=0,c=this._needsRemoving.length;c>b;b++)d=this._needsRemoving[b],d.newlatlng=d.layer._latlng,d.layer._latlng=d.latlng;for(b=0,c=this._needsRemoving.length;c>b;b++)d=this._needsRemoving[b],this._removeLayer(d.layer,!0),d.layer._latlng=d.newlatlng;this._needsRemoving=[],this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),c=this._needsClustering,this._needsClustering=[],this.addLayers(c,!0)},onRemove:function(a){a.off("zoomend",this._zoomEnd,this),a.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),delete this._maxLat,this._hideCoverage(),this._featureGroup.remove(),this._nonPointGroup.remove(),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(a){for(var b=a;b&&!b._icon;)b=b.__parent;return b||null},_arraySplice:function(a,b){for(var c=a.length-1;c>=0;c--)if(a[c]===b)return a.splice(c,1),!0},_removeFromGridUnclustered:function(a,b){for(var c=this._map,d=this._gridUnclustered,e=this._map.getMinZoom();b>=e&&d[b].removeObject(a,c.project(a.getLatLng(),b));b--);},_childMarkerDragStart:function(a){a.target.__dragStart=a.target._latlng},_childMarkerMoved:function(a){if(!this._ignoreMove&&!a.target.__dragStart){var b=a.target._popup&&a.target._popup.isOpen();this._moveChild(a.target,a.oldLatLng,a.latlng),b&&a.target.openPopup()}},_moveChild:function(a,b,c){a._latlng=b,this.removeLayer(a),a._latlng=c,this.addLayer(a)},_childMarkerDragEnd:function(a){a.target.__dragStart&&this._moveChild(a.target,a.target.__dragStart,a.target._latlng),delete a.target.__dragStart},_removeLayer:function(a,b,c){var d=this._gridClusters,e=this._gridUnclustered,f=this._featureGroup,g=this._map,h=this._map.getMinZoom();b&&this._removeFromGridUnclustered(a,this._maxZoom);var i,j=a.__parent,k=j._markers;for(this._arraySplice(k,a);j&&(j._childCount--,j._boundsNeedUpdate=!0,!(j._zoom<h));)b&&j._childCount<=1?(i=j._markers[0]===a?j._markers[1]:j._markers[0],d[j._zoom].removeObject(j,g.project(j._cLatLng,j._zoom)),e[j._zoom].addObject(i,g.project(i.getLatLng(),j._zoom)),this._arraySplice(j.__parent._childClusters,j),j.__parent._markers.push(i),i.__parent=j.__parent,j._icon&&(f.removeLayer(j),c||f.addLayer(i))):j._iconNeedsUpdate=!0,j=j.__parent;delete a.__parent},_isOrIsParent:function(a,b){for(;b;){if(a===b)return!0;b=b.parentNode}return!1},fire:function(a,b,c){if(b&&b.layer instanceof L.MarkerCluster){if(b.originalEvent&&this._isOrIsParent(b.layer._icon,b.originalEvent.relatedTarget))return;a="cluster"+a}L.FeatureGroup.prototype.fire.call(this,a,b,c)},listens:function(a,b){return L.FeatureGroup.prototype.listens.call(this,a,b)||L.FeatureGroup.prototype.listens.call(this,"cluster"+a,b)},_defaultIconCreateFunction:function(a){var b=a.getChildCount(),c=" marker-cluster-";return c+=10>b?"small":100>b?"medium":"large",new L.DivIcon({html:"<div><span>"+b+"</span></div>",className:"marker-cluster"+c,iconSize:new L.Point(40,40)})},_bindEvents:function(){var a=this._map,b=this.options.spiderfyOnMaxZoom,c=this.options.showCoverageOnHover,d=this.options.zoomToBoundsOnClick;(b||d)&&this.on("clusterclick",this._zoomOrSpiderfy,this),c&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),a.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(a){for(var b=a.layer,c=b;1===c._childClusters.length;)c=c._childClusters[0];c._zoom===this._maxZoom&&c._childCount===b._childCount&&this.options.spiderfyOnMaxZoom?b.spiderfy():this.options.zoomToBoundsOnClick&&b.zoomToBounds(),a.originalEvent&&13===a.originalEvent.keyCode&&this._map._container.focus()},_showCoverage:function(a){var b=this._map;this._inZoomAnimation||(this._shownPolygon&&b.removeLayer(this._shownPolygon),a.layer.getChildCount()>2&&a.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(a.layer.getConvexHull(),this.options.polygonOptions),b.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var a=this.options.spiderfyOnMaxZoom,b=this.options.showCoverageOnHover,c=this.options.zoomToBoundsOnClick,d=this._map;(a||c)&&this.off("clusterclick",this._zoomOrSpiderfy,this),b&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),d.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var a=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._map.getMinZoom(),this._zoom,a),this._topClusterLevel._recursivelyAddChildrenToMap(null,Math.round(this._map._zoom),a),this._currentShownBounds=a}},_generateInitialClusters:function(){var a=this._map.getMaxZoom(),b=this._map.getMinZoom(),c=this.options.maxClusterRadius,d=c;"function"!=typeof c&&(d=function(){return c}),this.options.disableClusteringAtZoom&&(a=this.options.disableClusteringAtZoom-1),this._maxZoom=a,this._gridClusters={},this._gridUnclustered={};for(var e=a;e>=b;e--)this._gridClusters[e]=new L.DistanceGrid(d(e)),this._gridUnclustered[e]=new L.DistanceGrid(d(e));this._topClusterLevel=new this._markerCluster(this,b-1)},_addLayer:function(a,b){var c,d,e=this._gridClusters,f=this._gridUnclustered,g=this._map.getMinZoom();for(this.options.singleMarkerMode&&this._overrideMarkerIcon(a),a.on(this._childMarkerEventHandlers,this);b>=g;b--){c=this._map.project(a.getLatLng(),b);var h=e[b].getNearObject(c);if(h)return h._addChild(a),void(a.__parent=h);if(h=f[b].getNearObject(c)){var i=h.__parent;i&&this._removeLayer(h,!1);var j=new this._markerCluster(this,b,h,a);e[b].addObject(j,this._map.project(j._cLatLng,b)),h.__parent=j,a.__parent=j;var k=j;for(d=b-1;d>i._zoom;d--)k=new this._markerCluster(this,d,k),e[d].addObject(k,this._map.project(h.getLatLng(),d));return i._addChild(k),void this._removeFromGridUnclustered(h,b)}f[b].addObject(a,c)}this._topClusterLevel._addChild(a),a.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(a){a instanceof L.MarkerCluster&&a._iconNeedsUpdate&&a._updateIcon()})},_enqueue:function(a){this._queue.push(a),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var a=0;a<this._queue.length;a++)this._queue[a].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){var a=Math.round(this._map._zoom);this._processQueue(),this._zoom<a&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._map.getMinZoom(),this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,a)):this._zoom>a?(this._animationStart(),this._animationZoomOut(this._zoom,a)):this._moveEnd()},_getExpandedVisibleBounds:function(){return this.options.removeOutsideVisibleBounds?L.Browser.mobile?this._checkBoundsMaxLat(this._map.getBounds()):this._checkBoundsMaxLat(this._map.getBounds().pad(1)):this._mapBoundsInfinite},_checkBoundsMaxLat:function(a){var b=this._maxLat;return b!==c&&(a.getNorth()>=b&&(a._northEast.lat=1/0),a.getSouth()<=-b&&(a._southWest.lat=-1/0)),a},_animationAddLayerNonAnimated:function(a,b){if(b===a)this._featureGroup.addLayer(a);else if(2===b._childCount){b._addToMap();var c=b.getAllChildMarkers();this._featureGroup.removeLayer(c[0]),this._featureGroup.removeLayer(c[1])}else b._updateIcon()},_extractNonGroupLayers:function(a,b){var c,d=a.getLayers(),e=0;for(b=b||[];e<d.length;e++)c=d[e],c instanceof L.LayerGroup?this._extractNonGroupLayers(c,b):b.push(c);return b},_overrideMarkerIcon:function(a){return a.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[a]}})}}),L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-1/0,-1/0),new L.LatLng(1/0,1/0))}),L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(a,b){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._map.getMinZoom(),a),this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(a,b){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._map.getMinZoom(),a),this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(a,b){this._animationAddLayerNonAnimated(a,b)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationZoomIn:function(a,b){var c,d=this._getExpandedVisibleBounds(),e=this._featureGroup,f=this._map.getMinZoom();this._ignoreMove=!0,this._topClusterLevel._recursively(d,a,f,function(f){var g,h=f._latlng,i=f._markers;for(d.contains(h)||(h=null),f._isSingleParent()&&a+1===b?(e.removeLayer(f),f._recursivelyAddChildrenToMap(null,b,d)):(f.clusterHide(),f._recursivelyAddChildrenToMap(h,b,d)),c=i.length-1;c>=0;c--)g=i[c],d.contains(g._latlng)||e.removeLayer(g)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(d,b),e.eachLayer(function(a){a instanceof L.MarkerCluster||!a._icon||a.clusterShow()}),this._topClusterLevel._recursively(d,a,b,function(a){a._recursivelyRestoreChildPositions(b)}),this._ignoreMove=!1,this._enqueue(function(){this._topClusterLevel._recursively(d,a,f,function(a){e.removeLayer(a),a.clusterShow()}),this._animationEnd()})},_animationZoomOut:function(a,b){this._animationZoomOutSingle(this._topClusterLevel,a-1,b),this._topClusterLevel._recursivelyAddChildrenToMap(null,b,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,this._map.getMinZoom(),a,this._getExpandedVisibleBounds())},_animationAddLayer:function(a,b){var c=this,d=this._featureGroup;d.addLayer(a),b!==a&&(b._childCount>2?(b._updateIcon(),this._forceLayout(),this._animationStart(),a._setPos(this._map.latLngToLayerPoint(b.getLatLng())),a.clusterHide(),this._enqueue(function(){d.removeLayer(a),a.clusterShow(),c._animationEnd()})):(this._forceLayout(),c._animationStart(),c._animationZoomOutSingle(b,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(a,b,c){var d=this._getExpandedVisibleBounds(),e=this._map.getMinZoom();a._recursivelyAnimateChildrenInAndAddSelfToMap(d,e,b+1,c);var f=this;this._forceLayout(),a._recursivelyBecomeVisible(d,c),this._enqueue(function(){if(1===a._childCount){var g=a._markers[0];this._ignoreMove=!0,g.setLatLng(g.getLatLng()),this._ignoreMove=!1,g.clusterShow&&g.clusterShow()}else a._recursively(d,c,e,function(a){a._recursivelyRemoveChildrenFromMap(d,e,b+1)});f._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(b.body.offsetWidth)}}),L.markerClusterGroup=function(a){return new L.MarkerClusterGroup(a)},L.MarkerCluster=L.Marker.extend({initialize:function(a,b,c,d){L.Marker.prototype.initialize.call(this,c?c._cLatLng||c.getLatLng():new L.LatLng(0,0),{icon:this}),this._group=a,this._zoom=b,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._bounds=new L.LatLngBounds,c&&this._addChild(c),d&&this._addChild(d)},getAllChildMarkers:function(a){a=a||[];for(var b=this._childClusters.length-1;b>=0;b--)this._childClusters[b].getAllChildMarkers(a);for(var c=this._markers.length-1;c>=0;c--)a.push(this._markers[c]);return a},getChildCount:function(){return this._childCount},zoomToBounds:function(){for(var a,b=this._childClusters.slice(),c=this._group._map,d=c.getBoundsZoom(this._bounds),e=this._zoom+1,f=c.getZoom();b.length>0&&d>e;){e++;var g=[];for(a=0;a<b.length;a++)g=g.concat(b[a]._childClusters);b=g}d>e?this._group._map.setView(this._latlng,e):f>=d?this._group._map.setView(this._latlng,f+1):this._group._map.fitBounds(this._bounds)},getBounds:function(){var a=new L.LatLngBounds;return a.extend(this._bounds),a},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(a,b){this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._setClusterCenter(a),a instanceof L.MarkerCluster?(b||(this._childClusters.push(a),a.__parent=this),this._childCount+=a._childCount):(b||this._markers.push(a),this._childCount++),this.__parent&&this.__parent._addChild(a,!0)},_setClusterCenter:function(a){this._cLatLng||(this._cLatLng=a._cLatLng||a._latlng)},_resetBounds:function(){var a=this._bounds;a._southWest&&(a._southWest.lat=1/0,a._southWest.lng=1/0),a._northEast&&(a._northEast.lat=-1/0,a._northEast.lng=-1/0)},_recalculateBounds:function(){var a,b,c,d,e=this._markers,f=this._childClusters,g=0,h=0,i=this._childCount;if(0!==i){for(this._resetBounds(),a=0;a<e.length;a++)c=e[a]._latlng,this._bounds.extend(c),g+=c.lat,h+=c.lng;for(a=0;a<f.length;a++)b=f[a],b._boundsNeedUpdate&&b._recalculateBounds(),this._bounds.extend(b._bounds),c=b._wLatLng,d=b._childCount,g+=c.lat*d,h+=c.lng*d;this._latlng=this._wLatLng=new L.LatLng(g/i,h/i),this._boundsNeedUpdate=!1}},_addToMap:function(a){a&&(this._backupLatlng=this._latlng,this.setLatLng(a)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(a,b,c){this._recursively(a,this._group._map.getMinZoom(),c-1,function(a){var c,d,e=a._markers;for(c=e.length-1;c>=0;c--)d=e[c],d._icon&&(d._setPos(b),d.clusterHide())},function(a){var c,d,e=a._childClusters;for(c=e.length-1;c>=0;c--)d=e[c],d._icon&&(d._setPos(b),d.clusterHide())})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(a,b,c,d){this._recursively(a,d,b,function(e){e._recursivelyAnimateChildrenIn(a,e._group._map.latLngToLayerPoint(e.getLatLng()).round(),c),e._isSingleParent()&&c-1===d?(e.clusterShow(),e._recursivelyRemoveChildrenFromMap(a,b,c)):e.clusterHide(),e._addToMap()})},_recursivelyBecomeVisible:function(a,b){this._recursively(a,this._group._map.getMinZoom(),b,null,function(a){a.clusterShow()})},_recursivelyAddChildrenToMap:function(a,b,c){this._recursively(c,this._group._map.getMinZoom()-1,b,function(d){if(b!==d._zoom)for(var e=d._markers.length-1;e>=0;e--){var f=d._markers[e];c.contains(f._latlng)&&(a&&(f._backupLatlng=f.getLatLng(),f.setLatLng(a),f.clusterHide&&f.clusterHide()),d._group._featureGroup.addLayer(f))}},function(b){b._addToMap(a)})},_recursivelyRestoreChildPositions:function(a){for(var b=this._markers.length-1;b>=0;b--){var c=this._markers[b];c._backupLatlng&&(c.setLatLng(c._backupLatlng),delete c._backupLatlng)}if(a-1===this._zoom)for(var d=this._childClusters.length-1;d>=0;d--)this._childClusters[d]._restorePosition();else for(var e=this._childClusters.length-1;e>=0;e--)this._childClusters[e]._recursivelyRestoreChildPositions(a)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(a,b,c,d){var e,f;this._recursively(a,b-1,c-1,function(a){for(f=a._markers.length-1;f>=0;f--)e=a._markers[f],d&&d.contains(e._latlng)||(a._group._featureGroup.removeLayer(e),e.clusterShow&&e.clusterShow())},function(a){for(f=a._childClusters.length-1;f>=0;f--)e=a._childClusters[f],d&&d.contains(e._latlng)||(a._group._featureGroup.removeLayer(e),e.clusterShow&&e.clusterShow())})},_recursively:function(a,b,c,d,e){var f,g,h=this._childClusters,i=this._zoom;if(i>=b&&(d&&d(this),e&&i===c&&e(this)),b>i||c>i)for(f=h.length-1;f>=0;f--)g=h[f],a.intersects(g._bounds)&&g._recursively(a,b,c,d,e)},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}}),L.Marker.include({clusterHide:function(){return this.options.opacityWhenUnclustered=this.options.opacity||1,this.setOpacity(0)},clusterShow:function(){var a=this.setOpacity(this.options.opacity||this.options.opacityWhenUnclustered);return delete this.options.opacityWhenUnclustered,a}}),L.DistanceGrid=function(a){this._cellSize=a,this._sqCellSize=a*a,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(a,b){var c=this._getCoord(b.x),d=this._getCoord(b.y),e=this._grid,f=e[d]=e[d]||{},g=f[c]=f[c]||[],h=L.Util.stamp(a);this._objectPoint[h]=b,g.push(a)},updateObject:function(a,b){this.removeObject(a),this.addObject(a,b)},removeObject:function(a,b){var c,d,e=this._getCoord(b.x),f=this._getCoord(b.y),g=this._grid,h=g[f]=g[f]||{},i=h[e]=h[e]||[];for(delete this._objectPoint[L.Util.stamp(a)],c=0,d=i.length;d>c;c++)if(i[c]===a)return i.splice(c,1),1===d&&delete h[e],!0},eachObject:function(a,b){var c,d,e,f,g,h,i=this._grid;for(c in i){g=i[c];for(d in g)for(h=g[d],e=0,f=h.length;f>e;e++)a.call(b,h[e])&&(e--,f--)}},getNearObject:function(a){var b,c,d,e,f,g,h,i,j=this._getCoord(a.x),k=this._getCoord(a.y),l=this._objectPoint,m=this._sqCellSize,n=null;for(b=k-1;k+1>=b;b++)if(e=this._grid[b])for(c=j-1;j+1>=c;c++)if(f=e[c])for(d=0,g=f.length;g>d;d++)h=f[d],i=this._sqDist(l[L.Util.stamp(h)],a),m>i&&(m=i,n=h);return n},_getCoord:function(a){return Math.floor(a/this._cellSize)},_sqDist:function(a,b){var c=b.x-a.x,d=b.y-a.y;return c*c+d*d}},function(){L.QuickHull={getDistant:function(a,b){var c=b[1].lat-b[0].lat;return(b[0].lng-b[1].lng)*(a.lat-b[0].lat)+c*(a.lng-b[0].lng)},findMostDistantPointFromBaseLine:function(a,b){var c,d,e,f=0,g=null,h=[];for(c=b.length-1;c>=0;c--)d=b[c],(e=this.getDistant(d,a))>0&&(h.push(d),e>f&&(f=e,g=d));return{maxPoint:g,newPoints:h}},buildConvexHull:function(a,b){var c=[],d=this.findMostDistantPointFromBaseLine(a,b);return d.maxPoint?(c=c.concat(this.buildConvexHull([a[0],d.maxPoint],d.newPoints)),c=c.concat(this.buildConvexHull([d.maxPoint,a[1]],d.newPoints))):[a[0]]},getConvexHull:function(a){var b,c=!1,d=!1,e=!1,f=!1,g=null,h=null,i=null,j=null,k=null,l=null;for(b=a.length-1;b>=0;b--){var m=a[b];(!1===c||m.lat>c)&&(g=m,c=m.lat),(!1===d||m.lat<d)&&(h=m,d=m.lat),(!1===e||m.lng>e)&&(i=m,e=m.lng),(!1===f||m.lng<f)&&(j=m,f=m.lng)}return d!==c?(l=h,k=g):(l=j,k=i),[].concat(this.buildConvexHull([l,k],a),this.buildConvexHull([k,l],a))}}}(),L.MarkerCluster.include({getConvexHull:function(){var a,b,c=this.getAllChildMarkers(),d=[];for(b=c.length-1;b>=0;b--)a=c[b].getLatLng(),d.push(a);return L.QuickHull.getConvexHull(d)}}),L.MarkerCluster.include({_2PI:2*Math.PI,_circleFootSeparation:25,_circleStartAngle:Math.PI/6,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied!==this&&!this._group._inZoomAnimation){var a,b=this.getAllChildMarkers(),c=this._group,d=c._map,e=d.latLngToLayerPoint(this._latlng);this._group._unspiderfy(),this._group._spiderfied=this,b.length>=this._circleSpiralSwitchover?a=this._generatePointsSpiral(b.length,e):(e.y+=10,a=this._generatePointsCircle(b.length,e)),this._animationSpiderfy(b,a)}},unspiderfy:function(a){this._group._inZoomAnimation||(this._animationUnspiderfy(a),this._group._spiderfied=null)},_generatePointsCircle:function(a,b){var c,d,e=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+a),f=e/this._2PI,g=this._2PI/a,h=[];for(h.length=a,c=a-1;c>=0;c--)d=this._circleStartAngle+c*g,h[c]=new L.Point(b.x+f*Math.cos(d),b.y+f*Math.sin(d))._round();return h},_generatePointsSpiral:function(a,b){var c,d=this._group.options.spiderfyDistanceMultiplier,e=d*this._spiralLengthStart,f=d*this._spiralFootSeparation,g=d*this._spiralLengthFactor*this._2PI,h=0,i=[];for(i.length=a,c=a-1;c>=0;c--)h+=f/e+5e-4*c,i[c]=new L.Point(b.x+e*Math.cos(h),b.y+e*Math.sin(h))._round(),e+=g/h;return i},_noanimationUnspiderfy:function(){var a,b,c=this._group,d=c._map,e=c._featureGroup,f=this.getAllChildMarkers();for(c._ignoreMove=!0,this.setOpacity(1),b=f.length-1;b>=0;b--)a=f[b],e.removeLayer(a),a._preSpiderfyLatlng&&(a.setLatLng(a._preSpiderfyLatlng),delete a._preSpiderfyLatlng),a.setZIndexOffset&&a.setZIndexOffset(0),a._spiderLeg&&(d.removeLayer(a._spiderLeg),delete a._spiderLeg);c.fire("unspiderfied",{cluster:this,markers:f}),c._ignoreMove=!1,c._spiderfied=null}}),L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(a,b){var c,d,e,f,g=this._group,h=g._map,i=g._featureGroup,j=this._group.options.spiderLegPolylineOptions;for(g._ignoreMove=!0,c=0;c<a.length;c++)f=h.layerPointToLatLng(b[c]),d=a[c],e=new L.Polyline([this._latlng,f],j),h.addLayer(e),d._spiderLeg=e,d._preSpiderfyLatlng=d._latlng,d.setLatLng(f),d.setZIndexOffset&&d.setZIndexOffset(1e6),i.addLayer(d);this.setOpacity(.3),g._ignoreMove=!1,g.fire("spiderfied",{cluster:this,markers:a})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerCluster.include({_animationSpiderfy:function(a,b){var d,e,f,g,h,i,j=this,k=this._group,l=k._map,m=k._featureGroup,n=this._latlng,o=l.latLngToLayerPoint(n),p=L.Path.SVG,q=L.extend({},this._group.options.spiderLegPolylineOptions),r=q.opacity;for(r===c&&(r=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity),p?(q.opacity=0,q.className=(q.className||"")+" leaflet-cluster-spider-leg"):q.opacity=r,k._ignoreMove=!0,d=0;d<a.length;d++)e=a[d],i=l.layerPointToLatLng(b[d]),f=new L.Polyline([n,i],q),l.addLayer(f),e._spiderLeg=f,p&&(g=f._path,h=g.getTotalLength()+.1,g.style.strokeDasharray=h,g.style.strokeDashoffset=h),e.setZIndexOffset&&e.setZIndexOffset(1e6),e.clusterHide&&e.clusterHide(),m.addLayer(e),e._setPos&&e._setPos(o);for(k._forceLayout(),k._animationStart(),d=a.length-1;d>=0;d--)i=l.layerPointToLatLng(b[d]),e=a[d],e._preSpiderfyLatlng=e._latlng,e.setLatLng(i),e.clusterShow&&e.clusterShow(),p&&(f=e._spiderLeg,g=f._path,g.style.strokeDashoffset=0,f.setStyle({opacity:r}));this.setOpacity(.3),k._ignoreMove=!1,setTimeout(function(){k._animationEnd(),k.fire("spiderfied",{cluster:j,markers:a})},200)},_animationUnspiderfy:function(a){var b,c,d,e,f,g,h=this,i=this._group,j=i._map,k=i._featureGroup,l=a?j._latLngToNewLayerPoint(this._latlng,a.zoom,a.center):j.latLngToLayerPoint(this._latlng),m=this.getAllChildMarkers(),n=L.Path.SVG;for(i._ignoreMove=!0,i._animationStart(),this.setOpacity(1),c=m.length-1;c>=0;c--)b=m[c],b._preSpiderfyLatlng&&(b.closePopup(),b.setLatLng(b._preSpiderfyLatlng),delete b._preSpiderfyLatlng,g=!0,b._setPos&&(b._setPos(l),g=!1),b.clusterHide&&(b.clusterHide(),g=!1),g&&k.removeLayer(b),n&&(d=b._spiderLeg,e=d._path,f=e.getTotalLength()+.1,e.style.strokeDashoffset=f,d.setStyle({opacity:0})));i._ignoreMove=!1,setTimeout(function(){var a=0;for(c=m.length-1;c>=0;c--)b=m[c],b._spiderLeg&&a++;for(c=m.length-1;c>=0;c--)b=m[c],b._spiderLeg&&(b.clusterShow&&b.clusterShow(),b.setZIndexOffset&&b.setZIndexOffset(0),a>1&&k.removeLayer(b),j.removeLayer(b._spiderLeg),delete b._spiderLeg);i._animationEnd(),i.fire("unspiderfied",{cluster:h,markers:m})},200)}}),L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._map.off("zoomend",this._noanimationUnspiderfy,this),this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(a){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(a))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(a){this._spiderfied&&this._spiderfied.unspiderfy(a)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(a){a._spiderLeg&&(this._featureGroup.removeLayer(a),a.clusterShow&&a.clusterShow(),a.setZIndexOffset&&a.setZIndexOffset(0),this._map.removeLayer(a._spiderLeg),delete a._spiderLeg)}}),L.MarkerClusterGroup.include({refreshClusters:function(a){return a?a instanceof L.MarkerClusterGroup?a=a._topClusterLevel.getAllChildMarkers():a instanceof L.LayerGroup?a=a._layers:a instanceof L.MarkerCluster?a=a.getAllChildMarkers():a instanceof L.Marker&&(a=[a]):a=this._topClusterLevel.getAllChildMarkers(),this._flagParentsIconsNeedUpdate(a),this._refreshClustersIcons(),this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(a),this},_flagParentsIconsNeedUpdate:function(a){var b,c;for(b in a)for(c=a[b].__parent;c;)c._iconNeedsUpdate=!0,c=c.__parent},_refreshSingleMarkerModeMarkers:function(a){var b,c;for(b in a)c=a[b],this.hasLayer(c)&&c.setIcon(this._overrideMarkerIcon(c))}}),L.Marker.include({refreshIconOptions:function(a,b){var c=this.options.icon;return L.setOptions(c,a),this.setIcon(c),b&&this.__parent&&this.__parent._group.refreshClusters(this),this}})}(window,document);